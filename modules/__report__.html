<html>

<head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <style>
        body {
            font-style: normal;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 11pt;
        }

        span.subtitle {
            font-size: 12pt;
            font-weight: bold;
        }

        span.subtitle2 {
            font-size: 11pt;
            font-weight: bold;
        }

        table,
        table td,
        table th {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 2px;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 8pt;
        }

        table.overview {
            width: 16.5cm;
            margin-left: auto;
            margin-right: auto;
        }

        table.overview>thead>tr>th {
            min-width: 50px;
            background-color: rgb(49, 96, 183);
            color: white;
            font-size: 8pt;
        }

        table.overview>thead>tr>th:nth-child(1) {
            width: 60px;
        }

        table.overview>thead>tr>th:nth-child(2) {
            width: 150px;
        }

        table.overview>thead>tr>th:nth-child(3) {
            width: 60px;
        }

        table.overview>thead>tr>th:nth-child(4) {
            width: 110px;
        }

        table.overview>thead>tr>th:nth-child(5) {
            width: 100px;
        }

        table.overview>thead>tr>th:nth-child(6) {
            width: 60px;
        }

        table.overview>thead>tr>th:nth-child(7) {
            width: 50px;
        }

        table.overview>thead>tr>th:nth-child(8) {
            width: 50px;
        }

        table.overview>thead>tr>th:nth-child(9) {
            width: 50px;
        }

        table.overview>thead>tr>th:nth-child(10) {
            width: 50px;
        }

        table.overview>tbody>tr>td {
            min-width: 50px;
            font-size: 8pt;
        }

        table.overview>tbody>tr>td:nth-child(1) {
            text-align: center;
        }

        table.overview>tbody>tr>td:nth-child(2) {
            text-align: left;
        }

        table.overview>tbody>tr>td:nth-child(3) {
            text-align: center;
        }

        table.overview>tbody>tr>td:nth-child(4) {
            text-align: center;
        }

        table.overview>tbody>tr>td:nth-child(5) {
            text-align: center;
        }

        table.overview>tbody>tr>td:nth-child(6) {
            text-align: center;
        }

        table.overview>tbody>tr>td:nth-child(7) {
            text-align: center;
        }

        table.overview>tbody>tr>td:nth-child(8) {
            text-align: center;
        }

        table.overview>tbody>tr>td:nth-child(9) {
            text-align: center;
        }

        table.overview>tbody>tr>td:nth-child(10) {
            text-align: center;
        }

        table.overviewperf>thead>tr>th {
            min-width: 50px;
            background-color: rgb(49, 96, 183);
            color: white;
            font-size: 8pt;
        }

        table.overviewperf>tbody>tr>td {
            min-width: 50px;
            font-size: 8pt;
            text-align: right;
        }

        p.perfGraphContents1 {
            margin-left: 0cm;
        }

        p.perfGraphContents2 {
            margin-left: 1cm;
        }

        p.perfGraphContents3 {
            margin-left: 2cm;
        }

        page {
            background: white;
            display: block;
            margin: 0 auto;
            margin-bottom: 0.5cm;
            box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
            padding: 1cm 2.5cm 1cm 2.5cm;

        }

        page[size="A4"] {
            width: 166mm;
            /* 21.6cm - 2.5cm x 2 */
        }

        img.graph {
            width: 16.5cm;
            display: block;
            margin: 0 auto;
        }

        @media print {

            page {
                background: white;
                display: block;
                margin: 0 auto;
                box-shadow: none;
                padding: 1cm 2.5cm 1cm 2.5cm;
            }

        }
    </style>
</head>

<body>
    <page size="A4">
        <p class=perfGraphContents1>
            <span class=subtitle>Visión general</span>
        </p>
        <p class=perfGraphContents2>
            Periodo ${ devicesInfo[next(iter(devicesInfo))]['rangeStart']} - ${devicesInfo[next(iter(devicesInfo))]['rangeEnd']}.
        </p>
        <p class=perfGraphContents1 style="text-align:center">
        <table class=overview>
            <thead>
                <tr>
                    <th style="color: white;background-color: rgb(49, 96, 183);">Estado</th>
                    <th style="color: white;background-color: rgb(49, 96, 183);">Nombre de host</th>
                    <th style="color: white;background-color: rgb(49, 96, 183);">Versión TMOS</th>
                    <th style="color: white;background-color: rgb(49, 96, 183);">Dirección IP</th>
                    <th style="color: white;background-color: rgb(49, 96, 183);">Provisión</th>
                    <th style="color: white;background-color: rgb(49, 96, 183);">Uptime</th>
                    <th style="color: white;background-color: rgb(49, 96, 183);">Logs<br>> Warn </th>
                    <th style="color: white;background-color: rgb(49, 96, 183);">Sincro</th>
                    <th style="color: white;background-color: rgb(49, 96, 183);">Plataforma</th>
                    <th style="color: white;background-color: rgb(49, 96, 183);">Serial</th>
                </tr>
            </thead>
            <tbody>

% for deviceIp,deviceInfo in devicesInfo.items():
<%
sysProvision=", ".join(map(lambda tuple : tuple[0], deviceInfo['sysProvision']))
%>
                <tr>
                    <td>${deviceInfo['failoverStatus']}</td>
                    <td>${deviceInfo['hostname']}</td>
                    <td>${deviceInfo['tmosVersion']}</td>
                    <td>${deviceInfo['sysManagementIp']}</td>
                    <td>${sysProvision}</td>
                    <td>${deviceInfo['sysUptime']}</td>
                    <td>${deviceInfo['ltmLogs']}</td>
                    <td>${deviceInfo['syncStatus'][0][1]}</td>
                    <td>${deviceInfo['sysPlatformName']}</td>
                    <td>${deviceInfo['sysChassisSerial']}</td>            
                </tr>
% endfor
            </tbody>
        </table>
        </p>
        <br>
        <p class=perfGraphContents1>
            <span class=subtitle>Visión general rendimiento</span>
        </p>
        <p class=perfGraphContents2>
            Periodo ${devicesInfo[next(iter(devicesInfo))]['rangeStart']} - ${devicesInfo[next(iter(devicesInfo))]['rangeEnd']}.
        </p>
        <p class=perfGraphContents1 style="text-align:center">
<%

for deviceIp,deviceInfo in devicesInfo.items():
    allMaxValues={}
    for graph in deviceInfo['graphs']:
        for serie in graph['series']:
            if 'format-values' in serie and not serie['format-values']==None:
                if serie["overview-header"] :
                    allMaxValues[f"{serie['overview-header']}"] = serie['format-values'](int(serie['maxValue']) if serie['maxValue'].isnumeric() else 0)
            else:
                if serie["overview-header"] :
                    allMaxValues[f"{serie['overview-header']}"] = serie['maxValue']
    thStr=""
    for mvLabel,mvValue in allMaxValues.items():
        thStr+=f"<th>{mvLabel}</th>\n"
    #solo necesitamos los headers del primer device
    #mejorar en el futuro
    break
%>
        <table class=overviewperf>
            <thead>
                <tr>
                    <th style="color: white;background-color: rgb(49, 96, 183);">Nombre de host</th>
                    ${thStr}
                    <th style="color: white;background-color: rgb(49, 96, 183);">Comentario</th>
                </tr>
            </thead>
            <tbody>
% for deviceIp,deviceInfo in devicesInfo.items():
<%
    allMaxValues={}
    for graph in deviceInfo['graphs']:
        for serie in graph['series']:
            if 'format-values' in serie and not serie['format-values']==None:
                if serie["overview-header"] :
                    allMaxValues[f"{serie['overview-header']}"] = serie['format-values'](int(serie['maxValue']) if serie['maxValue'].isnumeric() else 0)
            else:
                if serie["overview-header"] :
                    allMaxValues[f"{serie['overview-header']}"] = serie['maxValue']
    tdStr=""
    for mvLabel,mvValue in allMaxValues.items():
        tdStr+=f"<td>{mvValue}</td>\n"
%>
                <tr>
                    <td>${deviceInfo['hostname']}</td>
                    ${tdStr}
                    <td>--COMENTARIO--</td>    
                </tr>
% endfor
            </tbody>
        </table>
        </p>
        <br>
% for deviceIp,deviceInfo in devicesInfo.items():
        <p class=perfGraphContents1>
            <span class=subtitle>Gráficos de rendimiento ${deviceInfo['hostname']}</span>
        </p>
        <p class=perfGraphContents2>
            Periodo ${deviceInfo['rangeStart']} - ${deviceInfo['rangeEnd']}.
        </p>
    % for graph in deviceInfo['graphs']:
        <%
        import base64
        maxValueInfo=[]
        for serie in graph['series']:
            if 'format-values' in serie and not serie['format-values']==None:
                maxValueInfo.append(f"{serie['label']} = {serie['format-values'](int(serie['maxValue']) if serie['maxValue'].isnumeric() else 0)}")
            else:
                maxValueInfo.append(f"{serie['label']} = {serie['maxValue']}")
        maxValueInfoStr=f'Valores máximos del periodo: {", ".join(maxValueInfo)}.'
        base64Image=base64.b64encode(open(graph['filename'], 'rb').read()).decode()
        %>

        <p class=perfGraphContents2>
            <span class=subtitle2>${graph['title']}</span>
        </p>
        <p class=perfGraphContents3>
            ${maxValueInfoStr}
        </p>
        <p class=perfGraphContents1 style="text-align:center">
            <img width=605 height=179
                src="data:image/png;base64,${base64Image}"
                class=graph>
        </p>
        <br>
    % endfor
% endfor
    </page>
</body>

</html>